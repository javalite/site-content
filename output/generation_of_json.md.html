<ol class=breadcrumb>
   <li>
<a href=/>Home</a>
</li>
   <li>
<a href=/activejdbc>ActiveJDBC</a>
</li>
   <li class=active>
Generation of json
</li>
</ol>
<div class=page-header>
   <h1>
Generation of json <small></small>
</h1>
</div>







<p>In context of a web application, especially when dealing with Ajax, it is handy to have your classes convert to to JSON to send to a browser. If you have a complex model with custom classes to be sent over, you will most likely write your JSON generation code, if however all you need is to convert ActiveJDBC models to JSON, this functionality is already available from your models without extra effort.</p>
<p>In more complicated situation, they probably would write some JSON generation code. However under simple condition, classes Model and LazyList already provide the basics.</p>
<h2 id="generate-simple-json-from-a-model">Generate simple JSON from a model</h2>
<p>Here is code that will provide stock JSON from a model:</p>
<pre class="sourceCode java"><code class="sourceCode java">Person p  = (Person)Person.<span class="fu">findById</span>(<span class="dv">1</span>);
String json = p.<span class="fu">toJson</span>(<span class="kw">true</span>);</code></pre>
<p>The JSON produced will look something like this:</p>
<pre class="sourceCode json"><code class="sourceCode json">{
  <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Person&quot;</span>,
  <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;1&quot;</span>,
  <span class="dt">&quot;updated_at&quot;</span>:<span class="st">&quot;2011-02-23 22:18:11.0&quot;</span>,
  <span class="dt">&quot;graduation_date&quot;</span>:<span class="st">&quot;1954-12-01&quot;</span>,
  <span class="dt">&quot;name&quot;</span>:<span class="st">&quot;John&quot;</span>,
  <span class="dt">&quot;dob&quot;</span>:<span class="st">&quot;1934-12-01&quot;</span>,
  <span class="dt">&quot;last_name&quot;</span>:<span class="st">&quot;Smith&quot;</span>,
  <span class="dt">&quot;created_at&quot;</span>:<span class="st">&quot;2011-02-23 22:18:11.0&quot;</span>
}</code></pre>
<p>The boolean parameter to the method <code>toJson()</code> is whether to generate human readable format or a single string.</p>
<h2 id="specify-output-attributes-for-generated-json">Specify output attributes for generated JSON</h2>
<p>A variation on the example above is to provide a list of attributes that you are interested in, so that only these attributes are included:</p>
<pre class="sourceCode java"><code class="sourceCode java">Person p  = (Person)Person.<span class="fu">findById</span>(<span class="dv">1</span>);
String json = p.<span class="fu">toJson</span>(<span class="kw">true</span>, <span class="st">&quot;last_name&quot;</span>, <span class="st">&quot;dob&quot;</span>);</code></pre>
<p>The resulting JSON will only include the attributes specified:</p>
<pre class="sourceCode json"><code class="sourceCode json">{
  <span class="dt">&quot;dob&quot;</span>:<span class="st">&quot;1934-12-01&quot;</span>,
  <span class="dt">&quot;last_name&quot;</span>:<span class="st">&quot;Smith&quot;</span>
}</code></pre>
<h2 id="inclusion-of-dependencies">Inclusion of dependencies</h2>
<p>When a model is has relationships, the generated JSON will loop through them to include their JSON into the parent JSON as well:</p>
<pre class="sourceCode java"><code class="sourceCode java">List&lt;User&gt; personList = User.<span class="fu">findAll</span>().<span class="fu">orderBy</span>(<span class="st">&quot;id&quot;</span>).<span class="fu">include</span>(Address.<span class="fu">class</span>);
User u = personList.<span class="fu">get</span>(<span class="dv">0</span>);
String json = u.<span class="fu">toJson</span>(<span class="kw">true</span>);</code></pre>
<p>result:</p>
<pre class="sourceCode json"><code class="sourceCode json">{
  <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.User&quot;</span>,
  <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;1&quot;</span>,
  <span class="dt">&quot;first_name&quot;</span>:<span class="st">&quot;Marilyn&quot;</span>,
  <span class="dt">&quot;email&quot;</span>:<span class="st">&quot;mmonroe@yahoo.com&quot;</span>,
  <span class="dt">&quot;last_name&quot;</span>:<span class="st">&quot;Monroe&quot;</span>,
  <span class="dt">&quot;children&quot;</span> : {
    <span class="er">addresses</span> : [
    {
      <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
      <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;1&quot;</span>,
      <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
      <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
      <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;123 Pine St.&quot;</span>,
      <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 31&quot;</span>,
      <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;1&quot;</span>,
      <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
    },
    {
      <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
      <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;2&quot;</span>,
      <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
      <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
      <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;456 Brook St.&quot;</span>,
      <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 21&quot;</span>,
      <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;1&quot;</span>,
      <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
    },
    {
      <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
      <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;3&quot;</span>,
      <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
      <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
      <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;23 Grove St.&quot;</span>,
      <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 32&quot;</span>,
      <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;1&quot;</span>,
      <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
    }
    ]
  }
}</code></pre>
<h2 id="generate-json-from-a-resultset">Generate JSON from a resultset</h2>
<p>Generating JSON from a LazyList is equally easy:</p>
<pre class="sourceCode java"><code class="sourceCode java">LazyList&lt;User&gt; personList = User.<span class="fu">findAll</span>().<span class="fu">orderBy</span>(<span class="st">&quot;id&quot;</span>).<span class="fu">include</span>(Address.<span class="fu">class</span>);
String json = personList.<span class="fu">toJson</span>(<span class="kw">true</span>);</code></pre>
<p>An example of generated JSON:</p>
<pre class="sourceCode json"><code class="sourceCode json">[
  {
    <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.User&quot;</span>,
    <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;1&quot;</span>,
    <span class="dt">&quot;first_name&quot;</span>:<span class="st">&quot;Marilyn&quot;</span>,
    <span class="dt">&quot;email&quot;</span>:<span class="st">&quot;mmonroe@yahoo.com&quot;</span>,
    <span class="dt">&quot;last_name&quot;</span>:<span class="st">&quot;Monroe&quot;</span>,
    <span class="dt">&quot;children&quot;</span> : {
      <span class="er">addresses</span> : [
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;1&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;123 Pine St.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 31&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;1&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      },
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;2&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;456 Brook St.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 21&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;1&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      },
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;3&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;23 Grove St.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 32&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;1&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      }
    ]
    }
  },
  {
    <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.User&quot;</span>,
    <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;2&quot;</span>,
    <span class="dt">&quot;first_name&quot;</span>:<span class="st">&quot;John&quot;</span>,
    <span class="dt">&quot;email&quot;</span>:<span class="st">&quot;jdoe@gmail.com&quot;</span>,
    <span class="dt">&quot;last_name&quot;</span>:<span class="st">&quot;Doe&quot;</span>,
    <span class="dt">&quot;children&quot;</span> : {
      <span class="er">addresses</span> : [
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;4&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;143 Madison St.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 34&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;2&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      },
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;5&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;153 Creek St.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 35&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;2&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      },
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;6&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;163 Gorge St.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 36&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;2&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      },
        {
        <span class="dt">&quot;type&quot;</span>:<span class="st">&quot;org.javalite.activejdbc.test_models.Address&quot;</span>,
        <span class="dt">&quot;id&quot;</span>:<span class="st">&quot;7&quot;</span>,
        <span class="dt">&quot;zip&quot;</span>:<span class="st">&quot;60606&quot;</span>,
        <span class="dt">&quot;state&quot;</span>:<span class="st">&quot;IL&quot;</span>,
        <span class="dt">&quot;address1&quot;</span>:<span class="st">&quot;173 Far Side.&quot;</span>,
        <span class="dt">&quot;address2&quot;</span>:<span class="st">&quot;apt 37&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>:<span class="st">&quot;2&quot;</span>,
        <span class="dt">&quot;city&quot;</span>:<span class="st">&quot;Springfield&quot;</span>
      }
    ]
    }
  }
]</code></pre>
<p>Since the <code>include()</code> was used, the corresponding children from the ADDRESSES table were queried too for their JSON.</p>
<h2 id="hydrate-activejdbc-models-from-json">Hydrate ActiveJDBC models from JSON</h2>
<p>Sometimes you need to do the opposite of generating JSON. For instance, when I build webservices using ActiveWeb, often a JSON document is posted in a web request, and it needs to be serialized to a model. This functionality is not built into ActiveJDBC because this would require adding a dependency to parse JSON, but it is not needed by most projects. The solution is super simple: add a class with this code to your project:</p>
<pre class="sourceCode java"><code class="sourceCode java"><span class="kw">import org.codehaus.jackson.map.ObjectMapper;</span>
<span class="kw">import java.io.IOException; import java.util.Map;</span>

<span class="kw">public</span> <span class="kw">class</span> JsonHelper {
 <span class="kw">public</span> <span class="dt">static</span> Map <span class="fu">toMap</span>(String json) {
   ObjectMapper mapper = <span class="kw">new</span> <span class="fu">ObjectMapper</span>();
   <span class="kw">try</span> {
       <span class="kw">return</span> mapper.<span class="fu">readValue</span>(json, Map.<span class="fu">class</span>);
   } <span class="kw">catch</span> (IOException e) { <span class="kw">throw</span> <span class="kw">new</span> RuntimeException(e); }
 }
 <span class="kw">public</span> <span class="dt">static</span> Map[] <span class="fu">toMaps</span>(String json) {
    ObjectMapper mapper = <span class="kw">new</span> <span class="fu">ObjectMapper</span>();
    <span class="kw">try</span> {
        <span class="kw">return</span> mapper.<span class="fu">readValue</span>(json, Map[].<span class="fu">class</span>);
    } <span class="kw">catch</span> (IOException e) { <span class="kw">throw</span> <span class="kw">new</span> RuntimeException(e); } }
}</code></pre>
<p>then add Jackson dependency:</p>
<pre class="sourceCode xml"><code class="sourceCode xml">  <span class="kw">&lt;dependency&gt;</span>
    <span class="kw">&lt;groupId&gt;</span>org.codehaus.jackson<span class="kw">&lt;/groupId&gt;</span>
    <span class="kw">&lt;artifactId&gt;</span>jackson-core-asl<span class="kw">&lt;/artifactId&gt;</span>
    <span class="kw">&lt;version&gt;</span>1.8.2<span class="kw">&lt;/version&gt;</span>
    <span class="kw">&lt;scope&gt;</span>test<span class="kw">&lt;/scope&gt;</span>
  <span class="kw">&lt;/dependency&gt;</span>

  <span class="kw">&lt;dependency&gt;</span>
    <span class="kw">&lt;groupId&gt;</span>org.codehaus.jackson<span class="kw">&lt;/groupId&gt;</span>
    <span class="kw">&lt;artifactId&gt;</span>jackson-mapper-asl<span class="kw">&lt;/artifactId&gt;</span>
    <span class="kw">&lt;version&gt;</span>1.8.2<span class="kw">&lt;/version&gt;</span>
    <span class="kw">&lt;scope&gt;</span>test<span class="kw">&lt;/scope&gt;</span>
  <span class="kw">&lt;/dependency&gt;</span></code></pre>
<p>After this, it is trivial to write code like this:</p>
<pre class="sourceCode java"><code class="sourceCode java"> Person p = <span class="kw">new</span> <span class="fu">Person</span>();
 String personJson = <span class="kw">... </span><span class="co">// initialized from web request or another source</span>
 p.<span class="fu">fromMap</span>(JsonHelper.<span class="fu">toMap</span>(personJson));</code></pre>
<blockquote>
<p>In general, if there is another format, say XML or YML, you can convert that to a Java Map, then initialize a model from that Map</p>
</blockquote>
